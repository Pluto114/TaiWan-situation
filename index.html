<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æµ·é£é™©æŒ‡æ•°ä»ªè¡¨ç›˜ (V3 - æŒ‡æ ‡æ¨¡å‹)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">å°æµ·é£é™©æŒ‡æ•°ä»ªè¡¨ç›˜ (V3)</h1>
            <p class="text-lg text-slate-400" id="last-updated">æ­£åœ¨åŠ è½½æ•°æ®...</p>
        </header>

        <!-- é£é™©æŒ‡æ•°æ˜¾ç¤º -->
        <div class="mb-8 p-6 bg-slate-800 rounded-2xl shadow-2xl flex flex-col items-center justify-center transition-all duration-300">
            <h2 class="text-2xl font-semibold text-slate-300 mb-4">å½“å‰é£é™©æŒ‡æ•°</h2>
            <div id="risk-index-display" class="text-8xl font-bold text-green-500 transition-colors duration-300">
                0
            </div>
            <div id="risk-level-display" class="mt-4 text-2xl font-semibold text-green-500 transition-colors duration-300">
                ä½é£é™©
            </div>
            <p id="risk-summary" class="text-slate-400 mt-2">è§¦å‘äº† 0 / 0 ä¸ªæŒ‡æ ‡</p>
        </div>

        <!-- è§¦å‘çš„æŒ‡æ ‡æ¸…å• -->
        <div class="mb-8 p-6 bg-slate-800 rounded-2xl shadow-xl">
            <h3 class="text-2xl font-semibold mb-6">å½“å‰è§¦å‘çš„é¢„è­¦ä¿¡å·</h3>
            <div id="triggered-list" class="space-y-4">
                <!-- åˆ—è¡¨å°†ç”± JS åŠ¨æ€å¡«å…… -->
                <p class="text-slate-400" id="no-triggers">æœªè§¦å‘ä»»ä½•å…³é”®æŒ‡æ ‡ã€‚</p>
            </div>
        </div>

        <!-- LLM åˆ†ææ‘˜è¦ -->
        <div class="bg-slate-800 rounded-2xl shadow-xl overflow-hidden">
            <details class="p-6">
                <summary class="text-2xl font-semibold cursor-pointer">æŸ¥çœ‹ LLM åˆ†ææ‘˜è¦ (ç‚¹å‡»å±•å¼€)</summary>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">

                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold mb-2 text-sky-400">ğŸ“ˆ ç»æµé‡‘è</h4>
                        <p id="r-econ" class="text-sm text-slate-300">...</p>
                    </div>

                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold mb-2 text-orange-400">ğŸ›¡ï¸ å†›äº‹åå‹¤</h4>
                        <p id="r-mil" class="text-sm text-slate-300">...</p>
                    </div>

                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold mb-2 text-red-400">ğŸ—£ï¸ æ”¿æ²»èˆ†è®º</h4>
                        <p id="r-pol" class="text-sm text-slate-300">...</p>
                    </div>

                    <div class="bg-slate-700 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold mb-2 text-teal-400">ğŸ“ åœ¨åœ°ä½“æ„Ÿ (å¦é—¨)</h4>
                        <p id="r-local" class="text-sm text-slate-300">...</p>
                    </div>

                </div>
            </details>
        </div>

    </div>

    <script>
        // è·å–æ˜¾ç¤ºå…ƒç´ 
        const riskIndexDisplay = document.getElementById('risk-index-display');
        const riskLevelDisplay = document.getElementById('risk-level-display');
        const riskSummary = document.getElementById('risk-summary');
        const lastUpdatedDisplay = document.getElementById('last-updated');
        const triggeredList = document.getElementById('triggered-list');
        const noTriggers = document.getElementById('no-triggers');

        // è·å– LLM ç†ç”±å…ƒç´ 
        const rEcon = document.getElementById('r-econ');
        const rMil = document.getElementById('r-mil');
        const rPol = document.getElementById('r-pol');
        const rLocal = document.getElementById('r-local');

        // æ›´æ–°é£é™©é¢œè‰²
        function updateRiskColor(totalRisk) {
            const elementsToUpdate = [riskIndexDisplay, riskLevelDisplay];
            elementsToUpdate.forEach(el => {
                el.classList.remove('text-green-500', 'text-yellow-500', 'text-red-500');
            });

            if (totalRisk < 20) {
                elementsToUpdate.forEach(el => el.classList.add('text-green-500'));
                riskLevelDisplay.textContent = 'ä½é£é™© (Low)';
            } else if (totalRisk < 50) {
                elementsToUpdate.forEach(el => el.classList.add('text-yellow-500'));
                riskLevelDisplay.textContent = 'ä¸­åº¦é£é™© (Medium)';
            } else {
                elementsToUpdate.forEach(el => el.classList.add('text-red-500'));
                riskLevelDisplay.textContent = 'é«˜åº¦é£é™© (High)';
            }
        }

        // åŠ¨æ€åˆ›å»ºè§¦å‘çš„æŒ‡æ ‡å¡ç‰‡
        function createIndicatorCard(indicator) {
            let bgColor = 'bg-slate-700';
            if (indicator.weight >= 90) bgColor = 'bg-red-900/50';
            else if (indicator.weight >= 70) bgColor = 'bg-orange-900/50';

            return `
                <div class="${bgColor} p-4 rounded-lg border border-slate-600">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-300">${indicator.id} - ${indicator.category}</span>
                        <span class="text-red-400 font-bold">æƒé‡: ${indicator.weight}</span>
                    </div>
                    <p class="text-slate-400 mt-2">${indicator.description}</p>
                </div>
            `;
        }

        // è‡ªåŠ¨åŠ è½½ V3 æ•°æ®
        async function loadScores() {
            try {
                const response = await fetch('scores-v3.json?t=' + new Date().getTime());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // 1. æ›´æ–°ä¸»åˆ†æ•°
                const score = data.score;
                riskIndexDisplay.textContent = score;
                riskSummary.textContent = `è§¦å‘äº† ${data.triggered_indicators_count} / ${data.total_indicators} ä¸ªæŒ‡æ ‡`;
                updateRiskColor(score);

                // 2. æ›´æ–°æ—¶é—´æˆ³
                const updatedDate = new Date(data.last_updated);
                lastUpdatedDisplay.textContent = `ä¸Šæ¬¡åˆ†æäº: ${updatedDate.toLocaleString()}`;

                // 3. å¡«å…… LLM ç†ç”±
                rEcon.textContent = "LLM åˆ†æ: " + data.category_reasoning.econ;
                rMil.textContent = "LLM åˆ†æ: " + data.category_reasoning.mil;
                rPol.textContent = "LLM åˆ†æ: " + data.category_reasoning.pol;
                rLocal.textContent = "LLM åˆ†æ: " + data.category_reasoning.local;

                // 4. å¡«å……è§¦å‘çš„æŒ‡æ ‡åˆ—è¡¨
                if (data.triggered_indicators_count > 0) {
                    noTriggers.style.display = 'none'; // éšè— "æœªè§¦å‘" æ¶ˆæ¯
                    let htmlContent = '';
                    data.triggered_indicators
                        .sort((a, b) => b.weight - a.weight) // æŒ‰æƒé‡å€’åºæ’åˆ—
                        .forEach(ind => {
                            htmlContent += createIndicatorCard(ind);
                        });
                    triggeredList.innerHTML = htmlContent;
                } else {
                    noTriggers.style.display = 'block'; // æ˜¾ç¤º "æœªè§¦å‘" æ¶ˆæ¯
                    triggeredList.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨
                }

            } catch (error) {
                console.error("åŠ è½½ scores-v3.json å¤±è´¥:", error);
                lastUpdatedDisplay.textContent = "åŠ è½½è‡ªåŠ¨åˆ†ææ•°æ®å¤±è´¥ã€‚è¯·å…ˆè¿è¡Œ analyst-v3.py è„šæœ¬ã€‚";
            }
        }

        // é¡µé¢åŠ è½½æ—¶ï¼Œè‡ªåŠ¨åŠ è½½ LLM çš„åˆ†æ•°
        document.addEventListener('DOMContentLoaded', loadScores);
    </script>
</body>
</html>